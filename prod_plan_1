Sub ProductionPlan_1()
    Dim w As Workbook
    Dim machines As Worksheet
    Dim items As Worksheet
    Dim item() As String
    Dim R As Range
    Dim i As Integer
    Dim j As Integer
    Dim k As Integer
    Dim l As Integer
    Dim n As Integer
    
    Set w = Workbooks("Problem1.xlsm")
    Set machines = w.Worksheets("Machines")
    Set items = w.Worksheets("Items")
    
    'Set active worksheet
    machines.Activate
        
    'count the number of items
    n = Cells(Rows.Count, "A").End(xlUp).Row - 3
    
    'count the number of machines each item can be produced on
    For i = 1 To n
        Cells(i + 3, 6) = _
        Application.WorksheetFunction.Sum(Range(Cells(i + 3, 2), Cells(i + 3, 5)))
    Next
    
    Cells(3, 6) = "# of machines"
    
    
    'Copy info about setup time and unit time
    Cells(3, 7) = Sheets(5).Cells(3, 2)
    Cells(3, 8) = Sheets(5).Cells(3, 3)
    
    For k = 1 To n
        For l = 1 To n
            If Cells(k + 3, 1) = Sheets(5).Cells(l + 3, 1) Then
                Cells(k + 3, 7) = Sheets(5).Cells(l + 3, 2).Value
                Cells(k + 3, 8) = Sheets(5).Cells(l + 3, 3).Value
            End If
        Next
    Next
    
    'Prepare sorting
    Cells(2, 2).Clear
    
    'Set Range for sorting
    Set R = Range("A3").CurrentRegion
    
    'Sort primarily in ascending order according to machines _
    and secondarily in descending order according to unit time
    R.Sort Key1:=Range("F4"), Order1:=xlAscending, Header:=xlYes, _
    Key2:=Range("H4"), Order2:=xlDescending, Header:=xlYes
    
End Sub
